===== GAME BUG =====
有时“重新来过”后，直接去“山洞初体验”会导致bug。（可能是游戏本身问题）
在同一段对话（例如新安当花楹支线）中，若出现两次时间棒，无论第二次选什么，都会重复第一次的输入（可能游戏本身问题）
在战斗中连续按F键，之后按F键会可能会不起作用（可能游戏本身问题）
跳跃提示符状态在退出游戏时没有清理（或者在进入游戏时没有重置），导致在“开始新游戏”或“滑雪”时一直显示该提示符（游戏本身问题）
FIXED: 大地图中城市图标对于鼠标是否移上去的判定不准（可能是取Alpha值时上下搞反了，可能是游戏本身问题）
魔剑养成界面在魔剑弹出动画时，无法切换到其他画面
有时战斗胜利后快速退出，人物脚步声会遗留在游戏中，直到下次战斗才消失
部分贴图Alpha通道为全部为全透明，导致一些问题（如剑冢九州散人后出现怪物，在战斗选择怪物时消失）
某些情况下，战斗界面中怪物绘制可能有BUG（遮挡关系错误，可能是Z深度缓冲的问题；例如神树的散花天女在靠近边缘站位时）
FIXED: 新安当升级到丁级，升级后多收购几次，有可能在点下“收购”按钮的那一刻界面卡住（见notes20170529.txt）


===== PATCH BUG =====
FIXED: 战斗胜利后，有一个鼠标位置没有修正好（猜测可能与GetCursorPos有关）
FIXED: 播放动画时，若LostDevice，则会导致之后的画面播放不出来
窗口化后，偶尔鼠标点击无效，切出再切回后恢复（无法稳定重现，原因不明）
FIXED: 窗口化后，在播放动画时捕获鼠标，此时按Alt+Tab鼠标仍然被截取
FIXED: 某些机器上播放动画时鼠标会闪烁，也许和消息循环有关？（已确认与WM_SETCURSOR有关）
FIXED: 关闭模板缓存后，由于播放动画时Clear()带有清除模板缓存的调用，导致无效调用，动画播放不出来
FIXED: GBENGINE根本没用到模板缓存，应该取消模板缓存的选项
FIXED: 注册表重定向不会自动创建save目录，所以在没有save目录的情况下会崩溃
FIXED: 更换2x贴图后，有些人物会变黑
FIXED: 在MBA Win7系统上，在游戏过程中按电源键休眠会导致程序Reset()错误
FIXED: 全屏幕切出后，在任务管理器中对游戏窗口（不是进程）结束任务，游戏并不会完全退出，还会在播放音乐（因为自己写的消息循环没处理WM_QUIT）
FIXED: 系统界面中，平行投影的东西都错位，大小也不对
FIXED: “五灵站位”位置虽然没错，但是大小却不会根据uiratio改变
FIXED: 主系统“队列”页面中“五灵站位”与“UI操作”鼠标位置虚拟化冲突问题（详见notes20160925.txt）
FIXED: 字体大小有上限，需要想办法解决，虽然最大大小在1080p下勉强够用（已可以更换系统字体）
FIXED: 窗口化可能导致垂直同步失效
FIXED: 更换字体后，战斗对话渐变效果错误，可能与颜色的Alpha通道有关
WONTFIX: 更换2x贴图后，冰风谷刚遇邪剑仙时，或者在剑冢遇到邪剑仙时，邪剑仙的动作贴图显示异常
FIXED: 与“仙剑3内存修改器”不兼容
FIXED: 普通3D游戏界面UI元素位置大小修正；住宿时点击客栈老板，弹出来的窗口与“买卖”、“当铺经营”的窗口模式不同，不能虚拟化，需要手工处理
FIXED: 在某些特定地点、特殊视角下，有些贴图会变成纯色，例如刚进剑冢时门的贴图、永安当仓库窗户的贴图（可能游戏本身问题），也许可以通过PIX的debug this pixel功能来调试
FIXED: 战斗界面天空盒子贴图有时也会变成纯色，例如璧山第一个酒坛妖怪
WONTFIX: 在新安当丁时彦处投资当铺，弹出窗口中标题处“当铺等级”的值显示有微小错位
FIXED: “动态模糊”相关功能
FIXED: 进入系统界面（如买卖等），背景拉伸（压缩）问题
FIXED: 系统界面背景在设备丢失后会消失或变成乱码
FIXED: launcher无法在某些系统中使用，因为API的地址发生了变化，需要动态获取
FIXED: 战斗界面gbPrintFont_NUM类显示的文字位置仍然错误，需要对CCBDisplayChain类、CCBSystem类（次要）进行逆向
FIXED: 战斗界面中各个操作窗口UI鼠标位置问题
FIXED: 战斗对话框位置大小不正确
FIXED: 敌人增益/减益图标位置大小不正确
FIXED: 代码注释中缺少TR_SCALE_系列的说明
FIXED: 紫萱、雪见武器拖影问题（使用相对计时器）
FIXED: 软件光标模式下，鼠标大小会受到fixui state的影响
FIXED: 创建ID3DXFont时需要预加载字体，否则可能会导致显示文字时有卡顿感
FIXED: 窗口化分辨率设为1900x1000时，战斗画面字体medium大小，会出现找不到对应大小的情况
FIXED: 开启垂直同步后，鼠标输入的延迟会增加（可以通过战斗胜利时鼠标火花特效滞后看出）
FIXED: 当使用原游戏字体字体替换时，文字会错位
FIXED: 系统界面周围需要遮挡（例如主菜单两边，大地图两边）
FIXED: 剧情诗词大小和位置不正确
FIXED: 剧情对话框大小和位置不正确
FIXED: 帧率问题（详见note20161209.txt）：当帧率不为60时会有一系列问题；最好请求60fps帧率（解决方案见notes20170218.txt）
FIXED: 减少输入延迟时，用StretchRect和LockRect的方法在touch memory被编译器优化掉了（或许可以仿照alloca写汇编，或者根本不需要touch memory）（暂时删去touch memory操作）
FIXED: 小游戏UI修正（包括那些只能通过剧情触发而不能通过游戏主菜单进入的）
FIXED: 屏幕比例不是4:3时，司南转动时会变形
FIXED: UI贴图很多情况下位置不准，会造成UI贴图看起来发虚
FIXED: UI很多都是D3DTEXF_POINT，放大质量不佳
FIXED: 游戏场景中人物表情图标（例如红心、心碎、汗等）位置和大小不正常（UIEmote）
FIXED: 游戏欢迎界面太极打开效果错位
FIXED: 游戏场景中可跳跃图标位置和大小不正常
FIXED: 当限制游戏帧率小于30时可能会导致动画播放画面卡住（但是音频正常）
FIXED: 播放动画时，CPU全部被占满
FIXED: 战斗中选择敌人时，有时敌人会显示不出来（例如璧山酒坛子）
FIXED: 刚进剑冢时，若被剑碰到会掉血，效果为人物红色闪烁，此时掉血提示文字位置不正确
FIXED: 使用线性纹理过滤器会导致拼接两纹理时出现缝隙（即使纹理坐标精确、顶点位置精确，也会出现问题）
FIXED: 场景矩形的放大因数（SF_SCENEUIRECT）这个东西很不合理，与整个UI变换框架十分不协调
FIXED: 播放动画时使用到了边长为非2整数次幂的纹理，可能在某些不支持该功能的计算机上出现问题
FIXED: 窗口化后，加载时间较长时，如果在加载期间点击窗口，则会导致窗口“无响应”，接下来DirectInput无法Acquire导致游戏退出
FIXED: gbResManager::FindResByName根据CRC32哈希判断，有较大概率会有“生日攻击”的问题。
FIXED: 过程动画播放有略微黑边，需要调整纹理寻址并clamp（已增加clampmovie选项）
FIXED: 修正acquire的过程中可能导致程序一直无响应（win7，启动时弹出窗口后切到其他程序，等待标题栏变色后切回，就会无响应；可能需要处理消息循环）
WONTFIX: 在没有限制帧率的界面中（例如战斗界面），列表鼠标滚轮敏感度可能异常（跟鼠标本身有关系，例如鼠标每次滚动多少、是否无级鼠标等）（GTA5貌似都有这种问题，我就不要考虑了）
FIXED: 使用硬件光标时，在程序开启后，捕获光标签，切出去，在程序想捕捉光标时，点客户区切回，光标消失。
FIXED: 注册表重定向功能中，若存档文件无法写入时，程序会报错退出，可以用更友好的方式（找不到配置文件时也可以用友好方式报错）
FIXED: 回魂仙梦框错位，修正后由于没有0.5偏移导致开启抗锯齿后，左、上边缘有亮线
FIXED: 切屏后，画面的“水波效果”（就是整个画面像水波一样波动的效果，例如龙葵回魂仙梦末尾雪见出现时的效果）失效了（UnderWater类）
FIXED: 画面的“水波效果”在某些机器上可能错误（当UnderWater::Inst()->m_iMode==1时，会采用后备方案绘制，可能有错位）
FIXED: RenderTarget创建的RTT纹理分辨率只有256x256，是否可以改大一些（例如，改大后可以提高“水波效果”的分辨率）（自带了m_ScreenPlane）
FIXED: 如果配置文件中有效行总大小超过4KB，则fail和warning时可能显示不全
FIXED: 配置文件应使用UTF8，增强繁体系统的用户体验（需要时，在程序内部由UTF8转为UNICODE）
FIXED: 若双开，某些系统下，第二个示例检测到双开，在WinMain返回后某处崩溃（未打任何补丁时也会崩溃）（通过直接TerminateProcess避免崩溃）
FIXED: 繁体字默认加粗可能不好看（freetype可以控制加粗的粗细，另外繁体点阵字不加粗）
FIXED: Win9x系统下，ID3DXFont可能显示有问题（用freetype即可避免此问题）
FIXED: 更新Win10 1703（创意者更新）后，宋体的某些字号下，字体渲染太细（轻、淡），导致不易阅读（解决方案：在说明文件中提示用户尝试不同字体输出质量）
FIXED: 添加游戏自带字体会与系统已经安装的字体冲突，导致游戏中显示的字体实际上是系统字体而不是游戏自带字体（解决方案：对游戏自带字体改名）
FIXED: freetype渲染方式下，在分辨率较高的机器上（例如4K显示屏），会导致某些繁体字显示不出来（因为实际的bitmap大小大于size了，导致无法layout）
FIXED: freetype渲染方式下，在某些特定显卡的机器上，开启抗锯齿后，字体边缘可能会有一些粗糙（失真；其他字的像素混入）（解决方案：在渲染文字时关闭抗锯齿，并为文字添加边框）
FIXED: 游戏欢迎界面的云的贴图的编辑可能有失真（亮线）（解决方案：对其用clampuilib；并且在渲染gbUIQuad是关闭抗锯齿）
FIXED: 由于缩放和舍入的原因，替换字体后，文字间距时大时小，看起来不美观（自动对齐）
FIXED: 当帧率较高时（约2500FPS），游戏中战斗时，人物行动条可能会变慢或卡住（见notes20170516.txt）
FIXED: 当提升声音系统的采样率后，游戏中音效播放效果很差（只有右声道，左声道有很多锯齿）（见notes20170716.txt）
FIXED: 由于asmpatch在保存现场时，只保存8个通用寄存器、x87浮点、EFLAGS，并没有保存SSE相关状态，因此在编译时应禁止SSE指令集
FIXED: 当cbscalefactor>1时，战斗界面的血量显示文字可能会溢出到屏幕外边（例如与火鬼王战斗时）（见notes20170716.txt）


===== TODO =====
DONE: 根据播放剧情动画的内容，自动切掉动画的黑边（注意字幕问题）
DONE: 绕过CPK直接使用文件系统，可以使用config_flags &= ~2解决
DONE: 在全屏模式下也可以使用“关闭窗口”退出
DONE: 关闭窗口时提示存档保存问题
DONE: 允许不输入密码就直接调出游戏内置控制台
DONE: 日志截断（防止大量warning持续写硬盘）
DONE: 能让用户选择特定游戏状态是否对4:3比例留白，而不是只有一个统一的选项uiborder
DONE: 静态链接D3DX9_21
DONE: 统计FPS抖动
DONE: 允许配置抖动显示阈值
DONE: 允许自定义窗口比例（提供除4:3留白和全屏不留白之外的自定义选项），新增customrectN
DONE: 允许使用MSVC编译
DONE: 构建通用的纹理替换框架
DONE: 很有可能出现用到GBENGINE.DLL中的地址却忘记加gboffset的情况。可以通过将gbengine重定位(rebase)到0x40000000然后在memcpy_to_process系列函数中判断来测试，需要枚举选项。（也许有更好方法）
DONE: 添加配音接口
DONE: 在语音插件中添加不同类型配音的总开关
DONE: 添加截屏功能（按F8截屏，保存在snap文件夹下）
DONE: 仅限制逻辑帧率，这样就算不开垂直同步/或者显示器刷新率极高的情况下，游戏也能正常工作（通过根据场景限制帧数解决）
DONE: 繁体默认字体
DONE: 附带传统字体（winxp下的宋体和细明体）
DONE: 处理“窗口化”与“分辨率”搭配问题（“有边框”不宜选“当前分辨率”，“无边框”宜选“当前分辨率”）
DONE: 最好使用D3DXCheckVersion检查编译时的头文件是否与使用的库文件相匹配
DONE: 添加默认注册表条目
DONE: 自动检测游戏简繁版本，自动设置区域选项
DONE: 升级补丁时可能因为UAC虚拟化的原因，导致配置文件没有被正确覆盖（通过增加“恢复默认设置”功能解决）
DONE: 添加打开存档、截图文件夹的功能（注意UAC虚拟化）
DONE: 联网检测新版本功能
DONE: 向注册表中写入仙剑三的安装路径，以便仙剑三外继承存档使用
DONE: 将ptag的magic放到第一个字节，以便检测出某些修改器的冲突
DONE: 改进注册表重定向的读档代码，增加容错性
DONE: 让游戏代码检测不到F8按键，防止截屏功能与“任意键”冲突
DONE: 改进注册表重定向的提示文字
DONE: 为截屏增加提示文字
游戏修复工具（RS码+交织）
添加手柄支持
存档管理器（存档基本信息，修改日期，收藏存档，方便管理新的存档）
有可能出现不同补丁重复修改同一个内存位置而造成错误的情况，需要在底层检测
繁体翻译
切出时暂停音乐播放
兼容触屏
DEPRECATED: 改进IAT钩子的方式（增加除地址比对外的其他方案）
ABANDONED: 建立通用的gbVFileSystem的HOOK框架
ABANDONED: 更换2x贴图
ABANDONED: 重写launcher的shellcode（比较字符串时不使用ESP，防止对齐问题；或直接重写）
ABANDONED: 添加在硬件内存不足的情况下，禁止字体预加载的功能
ABANDONED: 默认/初次设置向导（专家系统）
ABANDONED: 限制FPS帧率时，下一个时间点取当前时间较好，还是取上一个时间点+间隔较好？
ABANDONED: 更换截屏方式（不要用GetFrontBufferData，用StretchRect到RenderTarget上）
ABANDONED: 使用Direct3D9Ex接口（没有D3DPOOL_MANAGED了）
ABANDONED: 增强ZPK功能（例如根据原文件名/原哈希找文件），并且允许同时打开多个ZPK
ABANDONED: 用矩阵乘法和齐次坐标重写变换框架（需要考虑UIWnd的tag问题）
ABANDONED: 允许交叉编译
ABANDONED: 添加多屏幕支持（例如三屏幕，在不同屏幕之间使用不同的透视投影矩阵）
ABANDONED: 添加VR支持
ABANDONED: 用AlphaBlend代替AlphaTest获得更好的透明效果（这几乎不可能实现）


===== NOT OUR BUG =====
在使用 mingw-gcc 3.4.2 编译时，若开启 -O2 编译优化，则会导致某些函数代码生成错误（原因未知，详情见notes20170404.txt）
在 linux 系统下用 wine 2.5 或更低版本运行时，会在读取配置文件时发生错误（见notes20170408.txt）
用新版 mingw-gcc 编译时，若不开启内联函数优化，则会在编译时弹出警告而导致编译终止（见notes20170408.txt）
用 mingw-gcc 编译时，有可能因为缺少 iconv 而导致编译失败（见notes20170408.txt）
用 gcc 编译时，因为 freetype 头文件中有非 ascii 字符，有可能因为 -finput-charset=cp936 选项而导致编译失败（见notes20170423.txt）
全屏幕模式运行的游戏可能会导致 Windows 10 的夜灯模式失效（应该是夜灯模式本身的问题）
TCC 编译器的 fastcall 调用约定是调用者将参数从栈上弹出而不是被调用者弹参（见notes20170827.txt）
TCC 编译器在遇到宽字符串字面值中有宽字符时，会直接按字节转换为wchar_t（见notes20170904.txt）
TCC 编译器当编译 DLL 时，在遇到直接将数字常量转换为函数指针的时候，生成的调用指令不正确（见notes20170904.txt）
用 freetype 2.8.1 时，由于没有初始化内存，粗体文本会显示不正常（freetype savannah；bug #52613）
用 freetype 2.8 或更低时，宋体的数字、字母等在小字号（类似点阵）的情况下显示得很难看，这可能是因为 hint 处理的 BUG 造成的，用 ftcharhack.c 可绕过（见 freetype 2.8.1 更新说明）
某些版本的 VC++ 2017（15.3/15.4）会导致 d3dx9.lib 链接失败，报 LNK1120 错误（在 15.5 中已修复）

